<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscar ClÃ­nica en Planes Colmena - Optimizado</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif; 
      background: linear-gradient(135deg, #0a1a2a, #0d2a3a);
      color: white; 
      margin: 0; 
      padding: 0;
    }
    
    header {
      background: linear-gradient(90deg, #0a1a2a, #12375a);
      padding: 40px 20px;
      text-align: center;
      border-bottom: 3px solid #d4af37;
    }
    
    h1 { 
      color: #d4af37; 
      font-size: 2.2rem; 
      margin: 0 0 10px 0;
    }
    
    .header-subtitle {
      color: #aaa;
      font-size: 1rem;
    }
    
    .performance-badge {
      display: inline-block;
      background: #4ade80;
      color: #0a1a2a;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
      margin-top: 10px;
    }
    
    main {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .busqueda-container {
      background: #112233;
      border: 2px solid #d4af37;
      border-radius: 15px;
      padding: 40px;
      margin-bottom: 40px;
    }
    
    .input-wrapper {
      position: relative;
      margin-bottom: 20px;
    }
    
    input[type="text"] {
      width: 100%;
      padding: 15px 50px 15px 15px;
      border-radius: 8px;
      border: 1px solid #d4af37;
      background: #1a3a5a;
      color: white;
      font-size: 1rem;
    }
    
    input[type="text"]::placeholder {
      color: #666;
    }
    
    input[type="text"]:focus {
      outline: none;
      background: #1a4a7a;
      border-color: #fbbf24;
    }
    
    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #d4af37;
      font-size: 1.2rem;
      pointer-events: none;
    }
    
    /* Autocomplete optimizado */
    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #0a1a2a;
      border: 2px solid #4ade80;
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 350px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
      box-shadow: 0 10px 30px rgba(74, 222, 128, 0.3);
    }
    
    .autocomplete-list.visible {
      display: block;
    }
    
    .autocomplete-item {
      padding: 15px;
      cursor: pointer;
      border-bottom: 1px solid #1a3a5a;
      transition: all 0.2s;
      position: relative;
    }
    
    .autocomplete-item:hover {
      background: #1a3a5a;
      border-left: 4px solid #4ade80;
      padding-left: 11px;
    }
    
    .autocomplete-item-nombre {
      font-weight: bold;
      color: #d4af37;
      font-size: 1rem;
      margin-bottom: 5px;
    }
    
    .autocomplete-item-ciudad {
      font-size: 0.85rem;
      color: #aaa;
    }
    
    .autocomplete-match-score {
      position: absolute;
      right: 15px;
      top: 15px;
      background: #4ade80;
      color: #0a1a2a;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .autocomplete-footer {
      padding: 10px;
      text-align: center;
      color: #666;
      font-size: 0.8rem;
      background: #0d1f2d;
      border-top: 1px solid #1a3a5a;
    }
    
    .info-section {
      background: #0d1f2d;
      border-left: 4px solid #60a5fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .stats-section {
      display: flex;
      gap: 20px;
      justify-content: space-around;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .stat-item {
      background: #0d1f2d;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      flex: 1;
      min-width: 150px;
      border: 1px solid #2a4a6a;
    }
    
    .stat-value {
      color: #4ade80;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .stat-label {
      color: #aaa;
      font-size: 0.85rem;
      margin-top: 5px;
    }
    
    .resultados {
      margin-top: 40px;
    }
    
    .resultado-titulo {
      color: #d4af37;
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .planes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .plan-card {
      background: #1a2a3a;
      border: 2px solid #d4af37;
      border-radius: 12px;
      padding: 25px;
      transition: all 0.3s;
    }
    
    .plan-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(212,175,55,0.3);
      border-color: #fbbf24;
    }
    
    .plan-card.secundario {
      border-color: #60a5fa;
    }
    
    .plan-card.secundario:hover {
      border-color: #a5c5ff;
    }
    
    .plan-titulo {
      color: #d4af37;
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 15px;
      word-break: break-word;
    }
    
    .plan-info {
      font-size: 0.9rem;
      line-height: 1.8;
      color: #ccc;
    }
    
    .plan-info-label {
      color: #aaa;
      font-weight: bold;
    }
    
    .plan-info-value {
      color: #4ade80;
      font-weight: bold;
    }
    
    .plan-info-value.amarillo {
      color: #fbbf24;
    }
    
    .plan-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-bottom: 10px;
      background: #d4af37;
      color: #0a1a2a;
    }
    
    .plan-badge.secundario {
      background: #60a5fa;
    }
    
    .clinica-info {
      background: linear-gradient(135deg, #0d1f2d, #1a3a5a);
      border: 2px solid #4ade80;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .clinica-nombre {
      color: #d4af37;
      font-size: 1.6rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .clinica-ciudad {
      color: #aaa;
      font-size: 1rem;
    }
    
    .search-metrics {
      display: flex;
      justify-content: space-between;
      background: #0d1f2d;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 0.85rem;
    }
    
    .metric {
      color: #aaa;
    }
    
    .metric span {
      color: #4ade80;
      font-weight: bold;
    }
    
    .error-msg {
      color: #ff8080;
      background: #2a1a1a;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #ff8080;
    }
    
    .loading {
      text-align: center;
      color: #60a5fa;
      font-size: 1.2rem;
      padding: 20px;
    }
    
    .botones-accion {
      text-align: center;
      margin-top: 40px;
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    button {
      padding: 15px 30px;
      background: #d4af37;
      color: #0a1a2a;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    button:hover {
      background: #fbbf24;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(212,175,55,0.4);
    }
    
    button.secundario {
      background: #60a5fa;
    }
    
    button.secundario:hover {
      background: #a5c5ff;
    }
    
    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      margin-top: 50px;
      border-top: 1px solid #3a5a7a;
    }
    
    .volver-link {
      color: #60a5fa;
      text-decoration: none;
      font-weight: bold;
    }
    
    .volver-link:hover {
      color: #d4af37;
    }
    
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      
      .busqueda-container {
        padding: 20px;
      }
      
      .planes-grid {
        grid-template-columns: 1fr;
      }
      
      .botones-accion {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
      
      .stats-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ¥ Buscar ClÃ­nica en Planes Colmena</h1>
    <p class="header-subtitle">Descubre quÃ© planes cubren tu clÃ­nica favorita</p>
    <span class="performance-badge">âš¡ BÃºsqueda Optimizada con IA</span>
  </header>
  
  <main>
    <div class="busqueda-container">
      <div class="info-section">
        <strong>ğŸ’¡ BÃºsqueda Inteligente:</strong> Empieza a escribir el nombre de tu clÃ­nica. El sistema usa algoritmos avanzados (Fuzzy Search + Ãndices Invertidos) para encontrar resultados incluso con errores de escritura. Ejemplo: "alemna" encontrarÃ¡ "Alemana".
      </div>
      
      <div class="stats-section">
        <div class="stat-item">
          <div class="stat-value" id="totalClinicas">-</div>
          <div class="stat-label">ClÃ­nicas Indexadas</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalPlanes">-</div>
          <div class="stat-label">Planes Disponibles</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="tiempoBusqueda">0ms</div>
          <div class="stat-label">Tiempo de BÃºsqueda</div>
        </div>
      </div>
      
      <div class="input-wrapper">
        <input 
          type="text" 
          id="clinicaBusqueda" 
          placeholder="Ej: Alemana, CatÃ³lica, DÃ¡vila, Las Condes..."
          autocomplete="off"
        />
        <span class="search-icon">ğŸ”</span>
        <div id="autocompleteList" class="autocomplete-list"></div>
      </div>
      
      <div id="statusMsg"></div>
    </div>
    
    <div id="resultados" class="resultados"></div>
  </main>
  
  <footer>
    <a href="index.html" class="volver-link">â† Volver a CotizaciÃ³n de Planes</a>
  </footer>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURACIÃ“N
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const URL_PLANES = 'planes_completos_DEFINITIVO.json';
    const URL_REDES = 'redes_clinicas_UNIFICADO.json';
    
    let PLANES = [];
    let REDES_CLINICAS = {};
    let UF_VALOR = 39700;
    
    // Variables de optimizaciÃ³n
    let INDICE_CLINICAS = null;
    let CACHE_NORMALIZACION = new Map();
    let TODAS_LAS_CLINICAS = [];
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ALGORITMOS DE OPTIMIZACIÃ“N
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function normalizarTextoOptimizado(texto) {
      if (!texto) return '';
      if (CACHE_NORMALIZACION.has(texto)) {
        return CACHE_NORMALIZACION.get(texto);
      }
      const resultado = texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
      CACHE_NORMALIZACION.set(texto, resultado);
      return resultado;
    }
    
    function calcularDistanciaLevenshtein(str1, str2) {
      const m = str1.length;
      const n = str2.length;
      if (Math.abs(m - n) > 5) return Math.max(m, n);
      const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
      for (let i = 0; i <= m; i++) dp[i][0] = i;
      for (let j = 0; j <= n; j++) dp[0][j] = j;
      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          if (str1[i - 1] === str2[j - 1]) {
            dp[i][j] = dp[i - 1][j - 1];
          } else {
            dp[i][j] = 1 + Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]);
          }
        }
      }
      return dp[m][n];
    }
    
    function crearNGramas(texto, n = 3) {
      const ngramas = new Set();
      const textoNorm = normalizarTextoOptimizado(texto);
      const palabras = textoNorm.split(/\s+/);
      palabras.forEach(palabra => {
        if (palabra.length >= 3) ngramas.add(palabra);
      });
      for (let i = 0; i <= textoNorm.length - n; i++) {
        ngramas.add(textoNorm.slice(i, i + n));
      }
      return ngramas;
    }
    
    function construirIndiceClinicas(listaClinicas) {
      console.log('ğŸ”§ Construyendo Ã­ndice invertido...');
      const inicio = performance.now();
      const indice = new Map();
      
      listaClinicas.forEach((clinica, idx) => {
        const ngramas = crearNGramas(clinica.nombre);
        ngramas.forEach(ngrama => {
          if (!indice.has(ngrama)) indice.set(ngrama, []);
          indice.get(ngrama).push(idx);
        });
      });
      
      const fin = performance.now();
      console.log('âœ… Ãndice construido en ' + (fin - inicio).toFixed(2) + 'ms');
      return indice;
    }
    
    function buscarClinicaOptimizada(terminoBusqueda, umbralFuzzy = 0.5) {
      const terminoNorm = normalizarTextoOptimizado(terminoBusqueda);
      if (!terminoNorm || terminoNorm.length < 1) return [];
      
      const ngramasBusqueda = crearNGramas(terminoNorm);
      const candidatos = new Map();
      
      ngramasBusqueda.forEach(ngrama => {
        const indices = INDICE_CLINICAS?.get(ngrama) || [];
        indices.forEach(idx => {
          candidatos.set(idx, (candidatos.get(idx) || 0) + 1);
        });
      });
      
      const resultados = Array.from(candidatos.entries())
        .map(([idx, matchesIndice]) => {
          const clinica = TODAS_LAS_CLINICAS[idx];
          const clinicaNorm = normalizarTextoOptimizado(clinica.nombre);
          const distancia = calcularDistanciaLevenshtein(terminoNorm, clinicaNorm);
          const maxLen = Math.max(terminoNorm.length, clinicaNorm.length);
          const similaridadFuzzy = 1 - (distancia / maxLen);
          const scoreIndice = matchesIndice / ngramasBusqueda.size;
          const scoreTotal = (scoreIndice * 0.4) + (similaridadFuzzy * 0.6);
          
          return {
            ...clinica,
            nombreNormalizado: clinicaNorm,
            score: scoreTotal,
            scoreFuzzy: similaridadFuzzy,
            scoreIndice: scoreIndice
          };
        })
        .filter(r => r.scoreFuzzy >= umbralFuzzy)
        .sort((a, b) => b.score - a.score);
      
      return resultados;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CARGAR DATOS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function cargarDatos() {
      try {
        console.log('ğŸ“¥ Cargando planes desde: ' + URL_PLANES);
        const respPlanes = await fetch(URL_PLANES);
        if (!respPlanes.ok) throw new Error('Error al cargar planes');
        PLANES = await respPlanes.json();
        console.log('âœ… Planes cargados: ' + PLANES.length);
        document.getElementById('totalPlanes').textContent = PLANES.length;
        
        console.log('ğŸ“¥ Cargando redes desde: ' + URL_REDES);
        const respRedes = await fetch(URL_REDES);
        if (!respRedes.ok) throw new Error('Error al cargar redes');
        REDES_CLINICAS = await respRedes.json();
        console.log('âœ… Redes cargadas: ' + Object.keys(REDES_CLINICAS).length);
        
        // Construir Ã­ndice de clÃ­nicas
        const clinicasArray = [];
        for (const [grupoId, grupoData] of Object.entries(REDES_CLINICAS)) {
          if (grupoData.clinicas) {
            grupoData.clinicas.forEach(clinica => {
              clinicasArray.push({
                nombre: clinica.nombre,
                ciudad: clinica.ciudad,
                grupo: grupoId,
                grupoNombre: grupoData.nombre
              });
            });
          }
        }
        
        TODAS_LAS_CLINICAS = clinicasArray;
        INDICE_CLINICAS = construirIndiceClinicas(clinicasArray);
        document.getElementById('totalClinicas').textContent = clinicasArray.length;
        
        try {
          const respUF = await fetch('https://mindicador.cl/api/uf');
          const dataUF = await respUF.json();
          UF_VALOR = Math.round(dataUF.UF.valor * 100) / 100;
          console.log('âœ… UF cargada: ' + UF_VALOR);
        } catch {
          console.log('â„¹ï¸ UF no disponible, usando valor por defecto');
        }
      } catch (err) {
        console.error('âŒ Error al cargar datos:', err);
        document.getElementById('statusMsg').innerHTML = '<div class="error-msg">âŒ Error al cargar datos. Recarga la pÃ¡gina.</div>';
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTOCOMPLETE OPTIMIZADO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let timeoutAutocomplete;
    function mostrarAutocomplete() {
      clearTimeout(timeoutAutocomplete);
      
      const input = document.getElementById('clinicaBusqueda').value.trim();
      const listElement = document.getElementById('autocompleteList');
      
      if (input.length < 1) {
        listElement.classList.remove('visible');
        return;
      }
      
      timeoutAutocomplete = setTimeout(() => {
        const inicio = performance.now();
        const resultados = buscarClinicaOptimizada(input, 0.4);
        const fin = performance.now();
        
        document.getElementById('tiempoBusqueda').textContent = (fin - inicio).toFixed(1) + 'ms';
        
        if (resultados.length === 0) {
          listElement.innerHTML = '<div class="autocomplete-footer">âŒ No se encontraron resultados</div>';
          listElement.classList.add('visible');
          return;
        }
        
        let html = '';
        resultados.slice(0, 8).forEach(clinica => {
          const matchPercent = Math.round(clinica.score * 100);
          html += `
            <div class="autocomplete-item" onclick='seleccionarClinica(${JSON.stringify(clinica.nombre)}, "${clinica.grupo}")'>
              <div class="autocomplete-item-nombre">${clinica.nombre}</div>
              <div class="autocomplete-item-ciudad">ğŸ“ ${clinica.ciudad} â€¢ ${clinica.grupoNombre}</div>
              <span class="autocomplete-match-score">${matchPercent}%</span>
            </div>
          `;
        });
        
        html += '<div class="autocomplete-footer">âš¡ BÃºsqueda en ' + (fin - inicio).toFixed(1) + 'ms â€¢ ' + resultados.length + ' resultados</div>';
        
        listElement.innerHTML = html;
        listElement.classList.add('visible');
      }, 150);
    }
    
    function seleccionarClinica(nombreClinica, grupoId) {
      document.getElementById('clinicaBusqueda').value = nombreClinica;
      document.getElementById('autocompleteList').classList.remove('visible');
      buscarPlanesPorClinica(nombreClinica, grupoId);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // BUSCAR PLANES POR CLÃNICA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function buscarPlanesPorClinica(nombreClinica, grupoId) {
      const statusMsg = document.getElementById('statusMsg');
      const resultados = document.getElementById('resultados');
      
      statusMsg.innerHTML = '';
      resultados.innerHTML = '';
      
      if (!nombreClinica) {
        statusMsg.innerHTML = '<div class="error-msg">âŒ Por favor selecciona una clÃ­nica</div>';
        return;
      }
      
      if (PLANES.length === 0) {
        statusMsg.innerHTML = '<div class="error-msg">âŒ Los planes aÃºn se estÃ¡n cargando</div>';
        return;
      }
      
      statusMsg.innerHTML = '<div class="loading">â³ Buscando planes...</div>';
      
      setTimeout(() => {
        const inicioBusqueda = performance.now();
        const grupoData = REDES_CLINICAS[grupoId];
        
        if (!grupoData) {
          statusMsg.innerHTML = '<div class="error-msg">âŒ ClÃ­nica no encontrada</div>';
          return;
        }
        
        const planesFiltrados = PLANES.filter(plan => 
          plan.coberturas_redes && plan.coberturas_redes[grupoId]
        );
        
        if (planesFiltrados.length === 0) {
          statusMsg.innerHTML = '<div class="error-msg">âŒ No hay planes disponibles para esta clÃ­nica</div>';
          return;
        }
        
        const planesConValor = planesFiltrados.map(plan => ({
          ...plan,
          cobertura: plan.coberturas_redes[grupoId]
        }));
        
        planesConValor.sort((a, b) => a.pb_uf - b.pb_uf);
        
        const planesSeleccionados = [];
        const coberturaUsadas = new Set();
        
        for (const plan of planesConValor) {
          if (planesSeleccionados.length >= 4) break;
          if (!coberturaUsadas.has(plan.cobertura)) {
            coberturaUsadas.add(plan.cobertura);
            planesSeleccionados.push(plan);
          }
        }
        
        if (planesSeleccionados.length < 4) {
          for (const plan of planesConValor) {
            if (planesSeleccionados.length >= 4) break;
            if (!planesSeleccionados.includes(plan)) {
              planesSeleccionados.push(plan);
            }
          }
        }
        
        const finBusqueda = performance.now();
        const tiempoTotal = finBusqueda - inicioBusqueda;
        
        mostrarPlanesSeleccionados(nombreClinica, grupoId, grupoData, planesSeleccionados, statusMsg, resultados, tiempoTotal);
      }, 300);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MOSTRAR PLANES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function mostrarPlanesSeleccionados(nombreClinica, grupoId, grupoData, planes, statusMsg, resultados, tiempoTotal) {
      statusMsg.innerHTML = '';
      
      let html = `
        <div class="clinica-info">
          <div class="clinica-nombre">âœ… ${nombreClinica}</div>
          <div class="clinica-ciudad">Red: ${grupoData.nombre}</div>
        </div>
        
        <div class="search-metrics">
          <div class="metric">Planes encontrados: <span>${planes.length}</span></div>
          <div class="metric">Tiempo bÃºsqueda: <span>${tiempoTotal.toFixed(1)}ms</span></div>
          <div class="metric">Algoritmo: <span>Fuzzy + Ãndice</span></div>
        </div>
        
        <div class="resultado-titulo">ğŸ“‹ Planes Disponibles</div>
        
        <div class="planes-grid">
      `;
      
      planes.forEach((plan, index) => {
        const badge = index === 0 ? 'principal' : 'secundario';
        const badgeText = index === 0 ? 'âœ¨ PLAN 1' : (index === 1 ? 'ğŸ”· PLAN 2' : (index === 2 ? 'ğŸŸ¢ PLAN 3' : 'ğŸ”µ PLAN 4'));
        
        const valorUF = plan.pb_uf ? plan.pb_uf.toFixed(2) : '0.00';
        const valorCLP = Math.round(plan.pb_uf * UF_VALOR);
        const cobertura = plan.cobertura || 'N/A';
        
        html += `
          <div class="plan-card ${badge === 'secundario' ? 'secundario' : ''}">
            <div class="plan-badge ${badge}">${badgeText}</div>
            
            <div class="plan-titulo">${plan.
