<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planes de Salud Colmena - AsesorÃ­a Profesional</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #0a1a2a; color: white; margin: 0; padding: 0; }
    header { background: linear-gradient(90deg, #0a1a2a, #12375a); padding: 40px; text-align: center; }
    h1 { color: #d4af37; font-size: 2.5rem; margin: 0; }
    h2 { color: #d4af37; }
    section { padding: 40px 20px; max-width: 900px; margin: auto; }
    .card { background: #112233; border: 1px solid #d4af37; padding: 25px; border-radius: 15px; margin-bottom: 25px; }
    button { background: #d4af37; color: #0a1a2a; padding: 15px 25px; border: none; border-radius: 10px; font-size: 1.1rem; cursor: pointer; }
    button:hover { opacity: 0.85; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    form input, form select, form textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; }
    .small { font-size: 0.9rem; color: #ccc; }
    .row { display:flex; gap:16px; flex-wrap: wrap; }
    .col { flex:1; min-width: 200px; }
    .success-msg { color: #4ade80; margin-top: 12px; font-weight: bold; }
    .error-msg { color: #ff8080; margin-top: 12px; }
    .plan-card { background: #112233; border: 2px solid #d4af37; border-radius: 15px; padding: 25px; margin: 25px 0; }
    .plan-nombre { font-size: 1.8rem; font-weight: bold; color: #d4af37; text-align: center; }
    .plan-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 20px 0; }
    .plan-info-item { background: #1a2a3a; padding: 15px; border-radius: 8px; text-align: center; }
    .plan-info-label { font-size: 0.8rem; color: #888; }
    .plan-info-value { font-size: 1.1rem; font-weight: bold; color: #fff; }
    .btn-asesoria { display: inline-block; background: linear-gradient(135deg, #d4af37, #f0c860); color: #0a1a2a; padding: 18px 40px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; border: none; cursor: pointer; }
    .btn-asesoria:hover { opacity: 0.9; }
    .referidos-section { background: linear-gradient(135deg,#0f2640 0%,#1a3a5a 100%); padding:60px 20px; margin:40px 0; }
    .referidos-container { max-width:800px; margin:0 auto; background:#112233; padding:40px; border-radius:20px; border:1px solid #d4af37; }
    .form-section { background:#1a2a3a; padding:25px; border-radius:15px; border-left:4px solid #d4af37; margin-bottom: 20px; }
    .form-section h3 { color:#d4af37; font-size:18px; margin-bottom:15px; margin-top: 0; }
    .btn-enviar-referido { background:linear-gradient(135deg,#d4af37,#f0c860); color:#0a1a2a; padding:15px 40px; border:none; border-radius:10px; font-size:16px; font-weight:700; cursor:pointer; width:100%; }
    .mensaje-exito, .mensaje-error { padding:15px; border-radius:10px; margin-top:20px; display:none; font-weight:600; text-align:center; }
    .mensaje-exito { background:#1a4d2e; color:#4ade80; border:1px solid #4ade80; }
    .mensaje-error { background:#4a1a1a; color:#ff8080; border:1px solid #ff8080; }
    .disclaimer { background: #1a2a3a; border-left: 4px solid #fbbf24; padding: 15px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; font-size: 0.85rem; color: #b8c5d6; }
    #resultado-preliminar { display: none; }
    #referidos { display: none; }
    @media (max-width: 600px) {
      button { padding: 12px 15px; font-size: 1rem; }
    }
  </style>
</head>
<body>

<header>
  <h1>AsesorÃ­a en Planes de Salud Colmena</h1>
  <p style="color: #d4af37;">AtenciÃ³n premium para clientes exigentes</p>
  <p class="small">Completa el formulario y elige tu camino.</p>
</header>

<section id="formulario" class="card">
  <h2 style="color: #d4af37;">Formulario para CÃ¡lculo del Plan</h2>
  <form id="mainForm">
    <div class="row">
      <div class="col"><input type="text" name="nombre" id="nombre" placeholder="Nombre completo" required /></div>
      <div class="col"><input type="email" name="correo" id="correo" placeholder="Correo electrÃ³nico" required /></div>
    </div>
    <div class="row">
      <div class="col"><input type="tel" name="telefono" id="telefono" placeholder="TelÃ©fono" required /></div>
      <div class="col"><input type="number" name="edad" id="edad" placeholder="Edad" min="18" max="99" required /></div>
    </div>
    <input type="text" name="rut" id="rut" placeholder="RUT (ej: 12.345.678-9)" required />
    <select name="isapre" id="isapre" required>
      <option value="">Isapre actual</option>
      <option>FONASA</option><option>Colmena</option><option>Cruz Blanca</option>
      <option>Consalud</option><option>BanmÃ©dica</option><option>Vida Tres</option>
      <option>Nueva Masvida</option><option>Esencial</option>
    </select>
    <input type="number" id="renta" name="renta" placeholder="Renta imponible mensual (CLP)" required />
    <textarea name="cargas" id="cargas" placeholder="Edades de cargas (ej: 5, 12, 30)" rows="2"></textarea>
    <select name="region" id="region" required>
      <option value="">Selecciona tu RegiÃ³n</option>
      <option value="Arica y Parinacota">RegiÃ³n de Arica y Parinacota</option>
      <option value="TarapacÃ¡">RegiÃ³n de TarapacÃ¡</option>
      <option value="Antofagasta">RegiÃ³n de Antofagasta</option>
      <option value="Atacama">RegiÃ³n de Atacama</option>
      <option value="Coquimbo">RegiÃ³n de Coquimbo</option>
      <option value="ValparaÃ­so">RegiÃ³n de ValparaÃ­so</option>
      <option value="Metropolitana">RegiÃ³n Metropolitana</option>
      <option value="O'Higgins">RegiÃ³n de O'Higgins</option>
      <option value="Maule">RegiÃ³n del Maule</option>
      <option value="Ã‘uble">RegiÃ³n de Ã‘uble</option>
      <option value="BÃ­o-BÃ­o">RegiÃ³n del BÃ­o-BÃ­o</option>
      <option value="La AraucanÃ­a">RegiÃ³n de La AraucanÃ­a</option>
      <option value="Los RÃ­os">RegiÃ³n de Los RÃ­os</option>
      <option value="Los Lagos">RegiÃ³n de Los Lagos</option>
      <option value="AysÃ©n">RegiÃ³n de AysÃ©n</option>
      <option value="Magallanes">RegiÃ³n de Magallanes</option>
    </select>
    <textarea name="mensaje" id="mensaje" placeholder="Mensaje adicional (opcional)" rows="2"></textarea>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
      <button type="submit" id="submitBtn" style="background: linear-gradient(135deg, #d4af37, #f0c860); color: #0a1a2a;">ğŸ“‹ Cotizar Ahora</button>
    </div>
    
    <p id="statusMsg" class="small" style="margin-top:10px;"></p>
  </form>
</section>

<section id="resultado-preliminar" class="card">
  <div id="resultadoDetalle"></div>
  <div style="text-align:center;margin-top:30px;">
    <button id="btnAsesoria" class="btn-asesoria">ğŸ“‹ Solicitar AsesorÃ­a Personalizada</button>
    <p class="small" style="margin-top:10px;">Un asesor te contactarÃ¡ a la brevedad.</p>
  </div>
</section>

<section class="referidos-section" id="referidos">
  <div class="referidos-container">
    <div style="text-align:center; margin-bottom:30px;">
      <h2 style="color:#d4af37; font-size:28px; margin-bottom:15px;">Â¿Quieres que asesoremos a un amigo?</h2>
      <p style="color:#b8c5d6; font-size:16px;">Ingresa los datos y nos comunicaremos con tu referido.</p>
    </div>
    <form id="formReferidos">
      <div class="form-section">
        <h3>ğŸ‘¤ Tus Datos</h3>
        <div style="margin-bottom: 15px;">
          <label style="display:block; color:#b8c5d6; margin-bottom:8px;">Tu Nombre *</label>
          <input type="text" id="nombreUsuario" required style="width:100%; padding:12px; border:2px solid #2a3a4a; border-radius:8px; background:#0a1a2a; color:white;">
        </div>
      </div>
      <div class="form-section">
        <h3>ğŸ¯ Datos del Referido</h3>
        <div style="margin-bottom: 15px;">
          <label style="display:block; color:#b8c5d6; margin-bottom:8px;">Nombre Completo *</label>
          <input type="text" id="nombreReferido" required style="width:100%; padding:12px; border:2px solid #2a3a4a; border-radius:8px; background:#0a1a2a; color:white;">
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display:block; color:#b8c5d6; margin-bottom:8px;">TelÃ©fono *</label>
          <input type="tel" id="telefonoReferido" required style="width:100%; padding:12px; border:2px solid #2a3a4a; border-radius:8px; background:#0a1a2a; color:white;">
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display:block; color:#b8c5d6; margin-bottom:8px;">Correo *</label>
          <input type="email" id="correoReferido" required style="width:100%; padding:12px; border:2px solid #2a3a4a; border-radius:8px; background:#0a1a2a; color:white;">
        </div>
      </div>
      <button type="submit" class="btn-enviar-referido">ğŸ“¤ Enviar Referido</button>
      <div id="mensajeExitoReferido" class="mensaje-exito">âœ… Â¡Referido Enviado!</div>
      <div id="mensajeErrorReferido" class="mensaje-error">âŒ Error al enviar.</div>
    </form>
  </div>
</section>

<footer style="text-align:center; padding:30px; color:#666; font-size:0.85rem;">
  Â© 2025 Colmena Golden Cross - AsesorÃ­a en Planes de Salud
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const FORM_URL_COTIZACION = 'https://docs.google.com/forms/d/e/1FAIpQLSdWN77vgHicHHkyq8w0ogOzP5MHnlhBSLZAObDyVQo-ILw73g/formResponse';
const FORM_FIELDS_COTIZACION = {
  nombre: 'entry.1455181501', rut: 'entry.1514828805', correo: 'entry.1253669566',
  telefono: 'entry.1927631596', edad: 'entry.1515225692', isapre: 'entry.1312575017',
  renta: 'entry.1350273122', region: 'entry.1283417188', cargas: 'entry.6457415',
  mensaje: 'entry.860152674', plan1: 'entry.1176082335', plan2: 'entry.1798986413',
  asesorid: 'entry.1496988494'
};

const FORM_URL_REFERIDOS = 'https://docs.google.com/forms/d/e/1FAIpQLSeIppjYB0Vgc6RsJ3AM0HcAVhLaxAT6ZZ_MxdPhmuwRkwLT-A/formResponse';
const FORM_FIELDS_REFERIDOS = {
  tu_nombre: "entry.1664559901", nombre_referido: "entry.715463265",
  telefono_referido: "entry.1382714918", correo_referido: "entry.897178414",
  asesorid_referidos: "entry.683967436"
};

const ASESORES = {
  jose_mora: { nombre: "JosÃ© Mora", whatsapp: "56975356696", apikey: "7360481" }
};

const asesorKey = "jose_mora";
const asesor = ASESORES[asesorKey];
const WHATSAPP_ASESORIA = asesor.whatsapp;
const CALLMEBOT_APIKEY = asesor.apikey;
const ASESOR_NOMBRE = asesor.nombre;

let formularioDatos = {};

function formatearCLP(n) { return (n || 0).toLocaleString("es-CL"); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENVÃO A GOOGLE FORMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function enviarAGoogleForms(datos, esReferido = false) {
  const url = esReferido ? FORM_URL_REFERIDOS : FORM_URL_COTIZACION;
  const fields = esReferido ? FORM_FIELDS_REFERIDOS : FORM_FIELDS_COTIZACION;
  const params = new URLSearchParams();
  
  Object.keys(datos).forEach(key => {
    if (fields[key]) params.append(fields[key], datos[key] || '');
  });
  
  fetch(url, { 
    method: "POST", 
    mode: "no-cors",
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: params.toString()
  }).then(() => console.log('âœ… Datos enviados a Google Forms')).catch(err => console.error('Error:', err));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENVÃO A WHATSAPP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function enviarCallMeBot(mensaje) {
  try {
    const url = `https://api.callmebot.com/whatsapp.php?phone=${WHATSAPP_ASESORIA}&text=${encodeURIComponent(mensaje)}&apikey=${CALLMEBOT_APIKEY}`;
    await fetch(url, { mode: 'no-cors' });
    console.log('âœ… WhatsApp enviado');
  } catch (err) { 
    console.error('Error WhatsApp:', err); 
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENTO COTIZAR AHORA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.getElementById("mainForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const btn = document.getElementById("submitBtn");
  const statusMsg = document.getElementById("statusMsg");
  
  btn.disabled = true;
  btn.textContent = "Calculando...";

  formularioDatos = {
    nombre: document.getElementById("nombre").value,
    correo: document.getElementById("correo").value,
    telefono: document.getElementById("telefono").value,
    edad: document.getElementById("edad").value,
    rut: document.getElementById("rut").value,
    isapre: document.getElementById("isapre").value,
    renta: document.getElementById("renta").value,
    cargas: document.getElementById("cargas").value || 'Sin cargas',
    region: document.getElementById("region").value,
    mensaje: document.getElementById("mensaje").value || '(sin mensaje)'
  };

  try {
    // ENVIAR A GOOGLE FORMS
    enviarAGoogleForms({
      nombre: formularioDatos.nombre,
      rut: formularioDatos.rut,
      correo: formularioDatos.correo,
      telefono: formularioDatos.telefono,
      edad: formularioDatos.edad,
      isapre: formularioDatos.isapre,
      renta: formularioDatos.renta,
      region: formularioDatos.region,
      cargas: formularioDatos.cargas,
      mensaje: formularioDatos.mensaje,
      plan1: 'Por calcular',
      plan2: 'Por calcular',
      asesorid: asesorKey
    });

    // ENVIAR A WHATSAPP
    const msgWA = `ğŸ”” NUEVA COTIZACIÃ“N\n\nğŸ‘¤ Cliente: ${formularioDatos.nombre}\nğŸ“ TelÃ©fono: ${formularioDatos.telefono}\nğŸ“§ Correo: ${formularioDatos.correo}\n\nğŸ“Š DATOS:\nâ€¢ Edad: ${formularioDatos.edad} aÃ±os\nâ€¢ RUT: ${formularioDatos.rut}\nâ€¢ Isapre: ${formularioDatos.isapre}\nâ€¢ RegiÃ³n: ${formularioDatos.region}\nâ€¢ Renta: $${formatearCLP(formularioDatos.renta)}\nâ€¢ Cargas: ${formularioDatos.cargas}\n\nğŸ“ Asesor: ${ASESOR_NOMBRE}`;
    
    enviarCallMeBot(msgWA);

    statusMsg.textContent = "âœ… Datos enviados correctamente";
    statusMsg.className = "small success-msg";

  } catch (err) {
    statusMsg.textContent = "âš ï¸ Error al enviar";
    statusMsg.className = "small error-msg";
    console.error('Error:', err);
  }

  let htmlResultado = `
    <div style="background: #0d1f2d; border: 1px solid #3a5a7a; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
      <div style="color: #d4af37; font-size: 1.3rem; margin-bottom: 15px; font-weight: bold;">ğŸ“Š Tu CotizaciÃ³n - ${formularioDatos.nombre}</div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
        <div style="text-align: center; padding: 15px; background: #112233; border-radius: 8px;">
          <div style="font-size: 0.85rem; color: #888; margin-bottom: 5px;">Tu 7% obligatorio</div>
          <div style="font-size: 1.2rem; font-weight: bold; color: #4ade80;">$${formatearCLP(formularioDatos.renta * 0.07)}</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #112233; border-radius: 8px;">
          <div style="font-size: 0.85rem; color: #888; margin-bottom: 5px;">Edad</div>
          <div style="font-size: 1.2rem; font-weight: bold; color: #fff;">${formularioDatos.edad} aÃ±os</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #112233; border-radius: 8px;">
          <div style="font-size: 0.85rem; color: #888; margin-bottom: 5px;">RegiÃ³n</div>
          <div style="font-size: 1.2rem; font-weight: bold; color: #fff;">${formularioDatos.region}</div>
        </div>
      </div>
    </div>
    <h2 style="color: #d4af37; margin-top:30px;">âœ… CotizaciÃ³n Recibida</h2>
    <p class="small">Tu solicitud ha sido enviada exitosamente. Nuestro asesor ${ASESOR_NOMBRE} se comunicarÃ¡ contigo en breve a travÃ©s de WhatsApp y correo electrÃ³nico.</p>
    <div class="disclaimer"><span style="color: #fbbf24; margin-right: 8px;">âš ï¸</span>RecibirÃ¡s un mensaje de WhatsApp con tus planes recomendados.</div>
  `;

  document.getElementById("resultado-preliminar").style.display = "block";
  document.getElementById("resultadoDetalle").innerHTML = htmlResultado;

  btn.disabled = false;
  btn.textContent = "Cotizar Ahora";

  setTimeout(() => {
    document.getElementById("resultado-preliminar").scrollIntoView({ behavior: "smooth" });
  }, 300);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOTÃ“N SOLICITAR ASESORÃA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.getElementById("btnAsesoria").addEventListener("click", function() {
  if (!formularioDatos || !formularioDatos.nombre) { 
    alert("Primero completa la cotizaciÃ³n"); 
    return; 
  }
  document.getElementById("referidos").style.display = "block";
  document.getElementById("referidos").scrollIntoView({ behavior: "smooth" });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMULARIO REFERIDOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.getElementById("formReferidos").addEventListener("submit", async function(e) {
  e.preventDefault();
  
  const nombreUsuario = document.getElementById("nombreUsuario").value;
  const nombreReferido = document.getElementById("nombreReferido").value;
  const telefonoReferido = document.getElementById("telefonoReferido").value;
  const correoReferido = document.getElementById("correoReferido").value;

  enviarAGoogleForms({
    tu_nombre: nombreUsuario,
    nombre_referido: nombreReferido,
    telefono_referido: telefonoReferido,
    correo_referido: correoReferido,
    asesorid_referidos: asesorKey
  }, true);

  document.getElementById("mensajeExitoReferido").style.display = "block";
  setTimeout(() => {
    document.getElementById("mainForm").reset();
    formularioDatos = {};
    document.getElementById("resultado-preliminar").style.display = "none";
    document.getElementById("referidos").style.display = "none";
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }, 2000);
});

</script>

</body>
</html>
